<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="view" style="width: 600px; height: 400px;">
    12我路代理商副驾驶的莲富大厦浪费

    <img src="//g-search2.alicdn.com/img/bao/uploaded/i4/i1/TB1W3ZvMVXXXXc8XFXXXXXXXXXX_!!0-item_pic.jpg?any_string_is_ok" crossorigin="anonymous">
</div>
<input type="button" value="截图" onclick="html2Image()"
       style="margin: 20px 0 0 20px;height: 50px;width: 100px;font-size: 2rem">


<div id="html2Images">
    <img id="html2Image" src="" alt="">
</div>

<script src="http://html2canvas.hertzen.com/dist/html2canvas.js"></script>
<script type="text/javascript">
  function html2Image() {
    var getPixelRatio = function(context) {     // 获取设备的PixelRatio
      var backingStore = context.backingStorePixelRatio ||
        context.webkitBackingStorePixelRatio ||
        context.mozBackingStorePixelRatio ||
        context.msBackingStorePixelRatio ||
        context.oBackingStorePixelRatio ||
        context.backingStorePixelRatio || 1;
      return (window.devicePixelRatio || 1) / backingStore;
    };
    var shareContent = document.getElementById("view");
    var width = shareContent.offsetWidth;
    var height = shareContent.offsetHeight;
    var canvas = document.createElement("canvas");
    var context = canvas.getContext('2d');
    var scale = getPixelRatio(context);    //将canvas的容器扩大PixelRatio倍，再将画布缩放，将图像放大PixelRatio倍。
    canvas.width = width * scale;
    canvas.height = height * scale;
    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';
    context.scale(scale, scale);
    var opts = {
      useCORS: true,
      allowTaint: false,
      logging: true,
      scale: scale,
      canvas: canvas,
      width: width,
      height: height,
      dpi: window.devicePixelRatio
    };
    html2canvas(shareContent, opts).then(function (canvas) {
      context.mozImageSmoothingEnabled = false;
      context.webkitImageSmoothingEnabled = false;
      context.msImageSmoothingEnabled = false;
      context.imageSmoothingEnabled = false;
      var dataUrl = canvas.toDataURL('image/jpeg', 1.0);
      var newImg = document.createElement("img");
      newImg.src =  dataUrl;
      newImg.width = width;
      newImg.height= height;
      document.getElementById("html2Images").appendChild(newImg);

      var downloadImg = document.createElement('a');
      downloadImg.href = dataUrl;
      downloadImg.download = 'haibao';
      downloadImg.click();
    });
  }
</script>
</body>
</html>
